Описание
========

Отправка уведомлений по расписанию. Расписание хранится в БД.

Два основных варианта отправки - регулярная отправка (ежедневно, с дополнительными условиями) и одноразовая.

Добавление расписаний
=====================

Варианты добавления:

- Прямая работа с базой данных

		INSERT INTO `sm_dates` (...) VALUES (...);
		CALL SCHEDULE_REGULAR('09:00:00', 'Добавлено хранимой процедурой SCHEDULE_REGULAR');
		CALL SCHEDULE_ONCE('2014-08-16 08:00:00', 'Добавлено хранимой процедурой SCHEDULE_ONCE');

- Отправка специально сформированного email

Отправление уведомлений
=======================

Варианты отправки:
- по email
- SMS
- RSS
- messengers


Описание таблицы расписания `sm_dates`
======================================

`date` - дата отправки или '0000-00-00' для регулярной отправки
`time` - время отправки
`last_send` - дата последней отправки (служебное поле)
`message` - текст сообщения (70 символов для унификации)

Условия регулярной отправки
`exclude_weekday` - исключить дни (в двоичном формате каждый день соответствует одному биту), первый день недели - Вс - по причине работы функции DAYOFWEEK()
Получение текущего дня недели в двоичном формате:
		
		SELECT POW(2, DAYOFWEEK(NOW())-1)

Вс=1, Пн=2, Вт=4, Ср=8, Чт=16, Пт=32, Сб=64

Представление `sm_schedule` служит для наглядности.

Механизм работы
===============

SQL
---

Смотри файл sql/work.sql

